---
title: "[리눅스 - 쉘 프로그래밍] 6. 쉘 프로그래밍"
date: 2023-04-08 09:00:00 +0900
categories: [임베디드, 리눅스]
tags: [devrunner, imbedded, linux, shell programming]
---

## 쉘이란?

---

CLI Shell은 여러가지가 있다.
주로 `dash`와 `bash` 두가지가 쓰이는데, 여기서 bash는 우리가 지금까지 써왔던 것이고, dash는 경량 형태의 쉘이라 임베디드 리눅스에서 주로 사용된다.
하지만 둘 다 쓰이는 명령어는 비슷하다.

## bash란?

---

언어는 스크립트를 기반으로 실행된다.
shell도 마찬가지다.
쉘 스크립트는 자동화 프로그램을 만들 때 주로 쓰인다.

bash shell 스크립트의 확장자는 `.sh`이다.
당연히 bash에서만 실행 가능하다.
다음과 같이 `shebang`이란 요소를 추가해 해당 스크립트가 bash 또는 dash 쉘 스크립트란 것을 명시해야 한다.

```bash
#! /bin/bash
```

쉘 스크립트는 다음 명령어로 실행할 수 있다.

```shell
$source a.sh

# 또는

$. a.sh
```

웬만하면 첫번째 실행문을 권장한다.

참고로 파이썬으로도 자동화 스크립트를 작성할 수 있다.
본인이 쌉고수가 아니라면 웬만하면 실전에서는 파이썬으로 작성하는 것이 좋을 것이다.

## bash 스크립트 문법

---

### 입출력

---

출력은 `echo`로, 입력은 `read`로 받는다.

- 예시

  코드:

  ```bash
  echo "hi!"
  read ans
  echo $ans
  ```

  결과:

  (입력: bjw)

  ```
  hi
  bjw
  ```

### 변수

---

bash 스크립트에서 변수 정의 시 모든 값들은 문자열로 취급한다.
때문에 수식도 먹히지 않고 기호까지 문자 그대로 저장된다.

변수 참조 시 변수명 앞에 '`$`'를 사용하면 된다

- 예시

  코드:

  ```bash
  #!/bin/bash

  bts=123
  kfc=546

  hot=$kfc
  god=kfc

  echo $hot
  echo $god
  ```

  결과:

  ```
  546
  kfc
  ```

### 띄어쓰기

---

bash에서 띄어쓰기를 조심해야 한다.
다음과 같이 띄어쓰기를 넣으면 에러가 난다.
변수가 아니라 명령어로 인식하기 때문이다.

```bash
bts = 100
```

### Argument 변수

---

bash 파일 실행 시 인자를 받아 해당 인자를 변수로 받는다.

- 예시

  실행 명령:

  ```shell
  $source a.sh 100 200 abc
  ```

  코드:

  ```bash
  #!/bin/bash

  echo $1
  echo $2
  echo $3
  ```

  결과:

  ```
  100
  200
  abc
  ```

### 산술 연산

---

`$(( ))`에 수식을 넣으면 산술 연산이 가능하다.

- 예시

  코드:

  ```bash
  #!/bin/bash

  bts=123

  abc=$(( $bts + 123 ))

  echo $abc
  ```

  결과:

  ```shell
  246
  ```

### 쉘 명령어 사용하기

---

`"변수"=$(쉘 명령어)`와 같이 정의하면 쉘 명령어의 결과가 변수에 저장된다.

### 비교연산자

---

| bash  | Clang Family |        의미        |
| :---: | :----------: | :----------------: |
| `-lt` |     `<`      |     less then      |
| `-eq` |     `=`      | equal(문자열 비교) |
| `-gt` |     `>`      |    greater than    |
| `-ne` |     `!=`     |     not equal      |
| `-ge` |     `>=`     |  greater or equal  |
| `-le` |     `<=`     |   less or equal    |

### 논리 연산자

---

C,C++과 동일하게 `||`,`&&`이 쓰인다.

### 조건문

---

bash에서도 조건문은 `if`와 `else`이다.
여기서도 띄어쓰기에 주의해야 한다.

- 예시

  코드:

  ```bash
  #!/bin/bash

  a=5

  if [ $a -gt 50 ] || [ $a -eq 5 ] ;then
    echo "Good!"
  else
    echo "Whatever"
  fi
  ```

  결과:

  ```
  Good!
  ```

### alias

---

`alias`는 별명을 만드는 명령어다.
C계열 언어의 `#define`과 비슷한 역할을 하는 언어이다.

- 예시

  ```bash
  alias ll=`ls -alF`
  alias la=`ls -alF`
  alias l=`ls -alF`
  ```

위 예시는 리눅스의 `~/.bashrc` 파일에 포함된 내용이다.
`~/.bashrc`는 bash 쉘이 시작되자마자 자동으로 시작되는 bash 스크립트 파일이다.

### 잘 안쓰이는 문법들

---

- printf

  C언어마냥 bash에도 printf가 있다.
  당연히 C언어의 printf와 사용법이 유사하다.

  - 예시

    코드:

    ```bash
    #!/bin/bash

    a=100
    b=3.14
    c="abc"

    printf "| %d |\n| %f |\n| %s |\n" $a $b $c
    ```

    결과:

    ```
    | 100 |
    | 3.140000 |
    | abc |
    ```

- 배열

  배열을 만들 때는 `()`를 사용한다.
  배열 값을 출력할 때는 `{}`를 사용한다.

  - 예시

    코드:

    ```bash
    #!/bin/bash

    arr=(10 20 30)

    echo ${arr[0]}
    echo ${arr[1]}
    echo ${arr[2]}
    ```

    결과:

    ```
    10
    20
    30
    ```

- for문

  역시 C언어의 for문과 동일하다.

  - 예시

    코드:

    ```bash
    #!/bin/bash

    arr=(10 20 30)

    for ((i=0; i<3; i++))

    do
      echo ${arr[i]}
    done
    ```

    결과:

    ```
    10
    20
    30
    ```

- 함수

  형태는 C 계열 언어들과 동일하며, 함수 호출 시 함수 이름만 입력하면 호출된다.

  - 예시

    ```bash
    #!/bin/bash

    abc(){
      printf "hi\n"
    }

    abc
    ```

## 환경 변수

---

환경 변수는 쉘에 저장되는 변수로, 시스템 전역적으로 사용되는 변수이다.
때문에 시스템 내 어디서든지 사용 가능하다.
스크립트에서도 사용 가능하다.

`printenv`명령어로 모든 환경변수를 조회할 수 있다.

`export (변수)=(값)` 명령어로 환경 변수를 추가할 수 있다.
("`printenv | grep (값)`" 명령으로 확인 가능)

하지만 이렇게 추가한 환경 변수는 터미널을 껐다가 켰을 때 유지가 되지 않는다.

`.bashrc` 파일에 환경변수 추가 명령어를 등록하면 해당 환경 변수는 유지된다.

## 압축

---

리눅스에서 가장 많이 사용되는 압축 방법 4가지는 다음과 같다.

- tar + xz
- zip
- tar + gz
- tar + bz2

참고로 리눅스 압축 프로그램들의 압축률은 다음과 같다.

zip < gz < bz2 < xz

압축률이 높을수록 속도는 느려진다.

### 압축을 배우는 이유

---

apt로 프로그램을 설치하는 경우 버전이 굉장히 오래된 경우가 있다.
웬만하면 최신 버전을 까는 것이 좋은데 이럴 경우 바이너리 파일을 받아서 압축 해제해서 따로 설치를 하는 과정이 필요하다.
리눅스에서는 이런 경우가 굉장히 많기 때문에 압축을 알아야 한다.

### zip

---

여러개의 파일들을 동시에 압축 가능하다.
압축 후 원본이 남아있으며, 압축을 풀 때 압축을 풀 디렉토리를 설정할 수 있다.

- `-r`: 하위 디렉토리 내부까지 모두 압축
- `unzip (압축 파일명)`: 압축 풀기
  - `-d (디렉토리)`: 해당 디렉토릴로 압축 풀기

### gzip,xz

---

둘 다 단일 파일만 압축할 수 있으며, 원본 파일이 압축 파일로 바뀐다.

성능은 다음과 같다.

xz >>>>>>>>> gzip >zip

### tar

---

기본적으로는 압축이 아니라 여러 파일들을 하나로 합치는 기능을 갖고 있다.
하지만 옵션을 통해 위의 압축 명령어들과 같은 기능을 실행할 수 있다.

- tar 사용법
  `tar -cvf`: 모으기
  `tar -xvf`: 모은 것 풀기

- tar.xz 사용법
  `tar -Jcvf`: 한 파일로 모으고, 압축하기
  `tar -Jxvf`: 압축 풀고, 모은 것 풀기

주의할 점으로, `tar`는 `zip`과 달리 압축을 풀 때 디렉토리를 따로 생성할 수 없기 때문에, 디렉토리를 따로 먼저 만들고 풀어야 한다.
